---
title: 监控对象
description: 监控对象
keywords:
  - 监控对象
  - 运维
  - 知识库
  - 系统环境
tags:
  - 监控对象
  - 运维
  - 知识库
  - 系统环境
---

# 监控对象（系统、服务、应用、日志）

监控体系需要覆盖 **系统层 → 服务层 → 应用层 → 日志与链路**，只有这样，才能实现端到端的可观测性（Observability）。以下内容包含常用工具、配置示例和参考链接，适合不同水平的读者。

---

## 系统层监控

### 目标

确保服务器硬件与操作系统健康，及时发现性能瓶颈或资源耗尽问题。

### 常见指标

* **CPU**：使用率、Load Average、上下文切换次数
* **内存**：使用率、Swap 使用情况
* **磁盘**：使用率、IO 延迟、读写速率
* **网络**：带宽、丢包率、连接数

### 常用工具

* [Node Exporter](https://prometheus.io/docs/guides/node-exporter/)（Prometheus 官方系统指标采集器）
* [collectd](https://collectd.org/)（通用性能采集工具）
* [Telegraf](https://www.influxdata.com/time-series-platform/telegraf/)（InfluxDB 生态的采集工具）

### 部署示例（Node Exporter）

```bash
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz
tar -zxvf node_exporter-1.8.2.linux-amd64.tar.gz
cd node_exporter-1.8.2.linux-amd64
./node_exporter --web.listen-address=":9100" &
```

### Prometheus 配置

```yaml
scrape_configs:
  - job_name: 'system'
    static_configs:
      - targets: ['192.168.1.10:9100', '192.168.1.11:9100']
```

### 告警规则示例

```yaml
- alert: HighCPULoad
  expr: 100 - (avg by(instance)(rate(node_cpu_seconds_total{mode="idle"}[2m])) * 100) > 85
  for: 2m
  labels:
    severity: critical
  annotations:
    summary: "高 CPU 使用率 (实例 {{ $labels.instance }})"
    description: "CPU 使用率超过 85% 持续 2 分钟"
```

---

## 服务层监控

### 目标

确保关键中间件和数据库的可用性与性能，避免成为业务瓶颈。

### 常见指标

* **Nginx**：QPS、响应时间、HTTP 状态码分布
* **MySQL**：连接数、QPS、慢查询数、主从延迟
* **Redis**：命中率、内存使用量、持久化状态
* **Kafka**：消息堆积、消费者延迟

### 常用工具

* [MySQL Exporter](https://github.com/prometheus/mysqld_exporter)
* [Redis Exporter](https://github.com/oliver006/redis_exporter)
* [Kafka Exporter](https://github.com/danielqsj/kafka_exporter)
* [Nginx VTS Exporter](https://github.com/hnlq715/nginx-vts-exporter)

### MySQL 监控示例

部署 MySQL Exporter：

```bash
docker run -d \
  -p 9104:9104 \
  -e DATA_SOURCE_NAME="user:password@(mysql-server:3306)/" \
  prom/mysqld-exporter
```

Prometheus 配置：

```yaml
scrape_configs:
  - job_name: 'mysql'
    static_configs:
      - targets: ['192.168.1.20:9104']
```

告警规则：

```yaml
- alert: MySQLReplicationLag
  expr: mysql_slave_status_seconds_behind_master > 60
  for: 2m
  labels:
    severity: critical
  annotations:
    summary: "MySQL 主从延迟 (实例 {{ $labels.instance }})"
    description: "主从复制延迟超过 60 秒"
```

---

## 应用层监控

### 目标

确保业务服务可用，关注与用户体验相关的核心指标（SLA）。

### 常见指标

* **可用性**：错误率、HTTP 5xx 比例
* **性能**：响应时间（P95、P99）
* **吞吐量**：QPS、TPS
* **业务指标**：订单数、支付成功率、活跃用户数

### 常用工具

* [Micrometer](https://micrometer.io/)（Spring Boot 默认监控库）
* [Prometheus Client Libraries](https://prometheus.io/docs/instrumenting/clientlibs/)（各语言指标暴露库）

### Java 示例（Micrometer）

```java
import io.micrometer.core.instrument.Counter;
import io.micrometer.core.instrument.MeterRegistry;

@RestController
public class OrderController {
    private final Counter orderCounter;

    public OrderController(MeterRegistry registry) {
        this.orderCounter = Counter.builder("app_orders_total")
            .description("订单数量")
            .register(registry);
    }

    @PostMapping("/order")
    public String createOrder() {
        orderCounter.increment(); // 每次订单请求 +1
        return "订单创建成功";
    }
}
```

Spring Boot 暴露 `/actuator/prometheus` 接口，Prometheus 配置：

```yaml
scrape_configs:
  - job_name: 'app'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['192.168.1.30:8080']
```

---

## 日志与链路监控

### 目标

用于问题定位与性能优化，弥补指标监控的盲区。

### 日志监控

常用工具：

* [EFK Stack](https://www.elastic.co/what-is/elk-stack)（Elasticsearch + Fluentd/Fluentbit + Kibana）
* [Grafana Loki](https://grafana.com/oss/loki/)（轻量日志存储）

Fluentd 输出日志到 Elasticsearch 示例：

```conf
<match app.logs>
  @type elasticsearch
  host es-server
  port 9200
  logstash_format true
  index_name app-logs
</match>
```

### 链路监控

常用工具：

* [Jaeger](https://www.jaegertracing.io/)
* [Apache SkyWalking](https://skywalking.apache.org/)
* [Zipkin](https://zipkin.io/)

Spring Boot 集成 Jaeger 示例：

```yaml
opentracing:
  jaeger:
    udp-sender:
      host: jaeger-agent
      port: 6831
```

