---
title: 系统初始化
description: 系统初始化
keywords:
  - 系统初始化
  - Linux
  - CentOS
  - Ubuntu
  - Debian
  - 运维
tags:
  - 系统初始化
  - Linux
  - CentOS
  - Ubuntu
  - Debian
  - 运维
  - 知识库
  - 系统环境
---

# 系统初始化

本文档提供 CentOS、Ubuntu 和 Debian 三个主流 Linux 发行版的详细初始化指南。

## 前言

系统初始化是服务器部署的重要环节，本指南涵盖网络配置、内核优化、安全加固、磁盘管理等关键步骤。

!!! tip
    建议在虚拟机中先行测试，确认无误后再在生产环境执行。

---

## 配置 NTP 时间同步


???+ warning 

    如果是内网环境，建议配置内网 NTP 服务器，避免依赖外网连接。


时间同步对于分布式系统和日志管理至关重要，推荐使用 chrony 服务。


=== "CentOS/RHEL"

    ``` bash
    # 安装并启动 chrony 服务
    sudo yum install -y chrony
    sudo systemctl enable chronyd --now
    sudo systemctl restart crond

    # 配置 NTP 服务器
    sudo tee -a /etc/chrony.conf << EOF
    server ntp.aliyun.com iburst
    server ntp1.aliyun.com iburst
    server ntp2.aliyun.com iburst
    EOF

    # 重启服务并验证状态
    sudo systemctl restart chronyd
    chronyc tracking
    chronyc sources -v
    ```


=== "Ubuntu/Debian"

    ``` bash
    # 安装并启动 chrony 服务
    sudo apt update && sudo apt install -y chrony
    sudo systemctl enable chronyd --now

    # 配置 NTP 服务器
    sudo tee -a /etc/chrony/chrony.conf << EOF
    server ntp.aliyun.com iburst
    server ntp1.aliyun.com iburst
    server ntp2.aliyun.com iburst
    EOF

    # 重启服务并验证状态
    sudo systemctl restart chrony
    chronyc tracking
    chronyc sources -v
    ```





## 配置静态 IP 地址

### CentOS/RHEL 系列

```bash
# 查看网络接口名称
ip addr show

# 编辑网络配置文件（以 ens32 为例）
sudo vim /etc/sysconfig/network-scripts/ifcfg-ens32
```

配置示例：
```ini
TYPE="Ethernet"
BOOTPROTO="static"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="no"
NAME="ens32"
DEVICE="ens32"
ONBOOT="yes"
IPADDR="192.168.1.100"
NETMASK="255.255.255.0"
GATEWAY="192.168.1.1"
DNS1="114.114.114.114"
DNS2="8.8.8.8"
```

```bash
# 重启网络服务
sudo systemctl restart NetworkManager
# 或者
sudo systemctl restart network
```

### Ubuntu/Debian 系列

Ubuntu 18.04+ 使用 Netplan：

```bash
# 查看现有配置文件
ls /etc/netplan/

# 编辑配置文件
sudo vim /etc/netplan/01-netcfg.yaml
```

配置示例：
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: no
      addresses:
        - 192.168.1.100/24
      gateway4: 192.168.1.1
      nameservers:
        addresses:
          - 114.114.114.114
          - 8.8.8.8
```

```bash
# 应用配置
sudo netplan apply

# 验证配置
ip addr show
```

对于较老的 Ubuntu/Debian 版本：

```bash
# 编辑网络接口配置
sudo vim /etc/network/interfaces
```

配置示例：
```
auto enp0s3
iface enp0s3 inet static
address 192.168.1.100
netmask 255.255.255.0
gateway 192.168.1.1
dns-nameservers 114.114.114.114 8.8.8.8
```

```bash
# 重启网络服务
sudo systemctl restart networking
```

## 3. 内核版本检查与升级

```bash
# 检查当前内核版本
uname -r

# 检查可用内核版本
rpm -qa | grep kernel  # CentOS/RHEL
dpkg -l | grep linux-image  # Ubuntu/Debian
```

### CentOS/RHEL 系列

```bash
# 安装 ELRepo 仓库（用于获取最新内核）
sudo rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
sudo dnf install -y https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm

# 安装最新稳定内核
sudo dnf --enablerepo=elrepo-kernel install -y kernel-ml

# 设置默认启动内核
sudo grub2-set-default 0
sudo grub2-mkconfig -o /boot/grub2/grub.cfg
```

### Ubuntu/Debian 系列

```bash
# 更新包列表
sudo apt update

# 安装最新内核
sudo apt install -y linux-generic linux-headers-generic

# 更新 GRUB 配置
sudo update-grub
```

:::danger 警告
内核升级有一定风险，建议：
1. 升级前创建系统快照或备份
2. 保留原有内核，以便出现问题时回退
3. 在测试环境验证无误后再在生产环境执行
:::

## 4. 安全配置

### 关闭不必要的服务

```bash
# 关闭防火墙（根据安全策略决定）
sudo systemctl stop firewalld  # CentOS/RHEL
sudo systemctl disable firewalld

sudo systemctl stop ufw  # Ubuntu/Debian
sudo systemctl disable ufw

# 关闭 SELinux（CentOS/RHEL）
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

# 关闭 AppArmor（Ubuntu/Debian）
sudo systemctl stop apparmor
sudo systemctl disable apparmor

# 关闭不必要的服务
sudo systemctl stop postfix rpcbind
sudo systemctl disable postfix rpcbind
```

### SSH 安全配置

```bash
# 备份原配置
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak

# 编辑 SSH 配置
sudo vim /etc/ssh/sshd_config
```

推荐的 SSH 安全配置：
```
# 修改默认端口（可选）
Port 22

# 禁止 root 直接登录（推荐）
PermitRootLogin no

# 禁用密码认证，仅使用密钥认证（高安全要求）
PasswordAuthentication yes
PubkeyAuthentication yes

# 设置登录超时
ClientAliveInterval 600
ClientAliveCountMax 0

# 限制登录用户
AllowUsers your-username

# 禁用空密码
PermitEmptyPasswords no
```

```bash
# 重启 SSH 服务
sudo systemctl restart sshd
```

## 5. 系统性能优化

### 内核参数调优

```bash
# 备份原配置
sudo cp /etc/sysctl.conf /etc/sysctl.conf.bak

# 创建优化配置
sudo tee /etc/sysctl.conf << EOF
# 文件系统优化
fs.file-max = 1048576
fs.aio-max-nr = 1048576

# 内存管理
vm.drop_caches = 3
vm.max_map_count = 262144
vm.swappiness = 10

# 共享内存
kernel.shmall = 4294967296
kernel.shmmax = 4294967295
kernel.shmmni = 4096

# 系统安全
kernel.sysrq = 0
kernel.dmesg_restrict = 1

# 信号量
kernel.sem = 250 32000 100 128

# 网络优化
net.ipv4.ip_forward = 1
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# TCP 优化
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 1024 65535

# 网络缓冲区
net.core.rmem_default = 16777216
net.core.rmem_max = 16777216
net.core.wmem_default = 16777216
net.core.wmem_max = 16777216
net.core.netdev_max_backlog = 5000
EOF

# 应用配置
sudo sysctl -p
```

### 文件描述符限制

```bash
# 设置系统级文件描述符限制
sudo tee -a /etc/security/limits.conf << EOF
* soft nofile 1048576
* hard nofile 1048576
* soft nproc 1048576
* hard nproc 1048576
EOF

# 设置 systemd 服务限制
sudo tee /etc/systemd/system.conf.d/limits.conf << EOF
[Manager]
DefaultLimitNOFILE=1048576
DefaultLimitNPROC=1048576
EOF
```

### 启用中断负载均衡

```bash
# 安装并启动 irqbalance
sudo yum install -y irqbalance  # CentOS/RHEL
sudo apt install -y irqbalance  # Ubuntu/Debian

sudo systemctl enable irqbalance --now
```

## 6. 磁盘管理

### 查看磁盘信息

```bash
# 查看磁盘分区
lsblk

# 查看文件系统
df -h

# 查看磁盘使用情况
fdisk -l
```

### 磁盘分区方案选择

| 磁盘大小 | 数据类型 | 推荐方案 | 优势 |
|---------|---------|---------|------|
| < 1TB | 非数据库 | LVM | 灵活扩容 |
| < 1TB | 数据库 | 原生分区 | 性能最优 |
| ≥ 1TB | 任意 | GPT 分区 | 支持大容量 |

### 创建 LVM 逻辑卷

```bash
# 创建物理卷
sudo pvcreate /dev/sdb

# 创建卷组
sudo vgcreate data_vg /dev/sdb

# 创建逻辑卷（使用全部空间）
sudo lvcreate -l 100%FREE -n data_lv data_vg

# 格式化为 ext4
sudo mkfs.ext4 /dev/data_vg/data_lv

# 创建挂载点并挂载
sudo mkdir -p /data
sudo mount /dev/data_vg/data_lv /data

# 设置开机自动挂载
echo '/dev/data_vg/data_lv /data ext4 defaults 0 2' | sudo tee -a /etc/fstab
```

### LVM 扩容

```bash
# 添加新磁盘到卷组
sudo pvcreate /dev/sdc
sudo vgextend data_vg /dev/sdc

# 扩展逻辑卷
sudo lvextend -l +100%FREE /dev/data_vg/data_lv

# 扩展文件系统
sudo resize2fs /dev/data_vg/data_lv
```

## 7. 开发环境配置

### 安装常用工具

```bash
# CentOS/RHEL
sudo yum groupinstall -y "Development Tools"
sudo yum install -y wget curl vim git tree htop iotop net-tools

# Ubuntu/Debian
sudo apt update
sudo apt install -y build-essential wget curl vim git tree htop iotop net-tools
```

### 配置 Vim

创建全局 vim 配置：
```bash
sudo tee /etc/vim/vimrc.local << EOF
syntax on
filetype on
set number
set ruler
set cursorline
set tabstop=4
set shiftwidth=4
set expandtab
set autoindent
set smartindent
set hlsearch
set incsearch
set ignorecase
set smartcase
set showcmd
set showmode
set laststatus=2
set backspace=indent,eol,start
set encoding=utf-8
colorscheme desert
EOF
```

### 配置 Git

```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
git config --global init.defaultBranch main
git config --global core.editor vim
```

## 8. 监控配置

### 安装系统监控工具

```bash
# 安装 htop、iotop、nethogs 等监控工具
sudo yum install -y epel-release  # CentOS/RHEL
sudo yum install -y htop iotop nethogs glances

sudo apt install -y htop iotop nethogs glances  # Ubuntu/Debian
```

### 配置日志轮转

```bash
# 配置系统日志轮转
sudo vim /etc/logrotate.d/custom

# 添加自定义日志轮转配置
/var/log/custom/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
}
```

## 9. 系统检查脚本

创建系统状态检查脚本：

```bash
sudo tee /usr/local/bin/system-check.sh << 'EOF'
#!/bin/bash

echo "=== System Status Check ==="
echo "Date: $(date)"
echo

echo "=== CPU Usage ==="
top -bn1 | grep "Cpu(s)" | awk '{print "CPU Usage: " $2 " user, " $4 " system, " $8 " idle"}'
echo

echo "=== Memory Usage ==="
free -h
echo

echo "=== Disk Usage ==="
df -h
echo

echo "=== Load Average ==="
uptime
echo

echo "=== Network Connections ==="
ss -tuln | head -10
echo

echo "=== Last 10 System Messages ==="
tail -10 /var/log/messages 2>/dev/null || tail -10 /var/log/syslog
EOF

sudo chmod +x /usr/local/bin/system-check.sh
```

## 10. 最终检查

系统初始化完成后，执行以下检查：

```bash
# 重启系统
sudo shutdown -r now

# 系统重启后执行检查
/usr/local/bin/system-check.sh

# 检查关键服务状态
systemctl status chronyd
systemctl status irqbalance

# 验证网络配置
ip addr show
ping -c 4 8.8.8.8

# 验证内核参数
sysctl net.ipv4.tcp_tw_reuse
sysctl fs.file-max

# 验证文件描述符限制
ulimit -n
```

## 总结
!!! tip 

        定期更新系统补丁
        监控系统资源使用情况
        备份重要配置文件
        制定灾难恢复计划
        建立系统变更记录
        
完成以上步骤后，您的 Linux 系统已经过基本优化和安全加固，具备了良好的运行基础。根据具体业务需求，可能还需要安装特定的软件包或进行进一步的定制化配置。



