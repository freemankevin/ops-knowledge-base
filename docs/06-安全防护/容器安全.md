---
title: Dockerå®¹å™¨å®‰å…¨æœ€ä½³å®è·µæŒ‡å—
description: å…¨é¢çš„Dockerå®¹å™¨å®‰å…¨é˜²æŠ¤ç­–ç•¥ï¼Œæ¶µç›–é•œåƒæ„å»ºã€è¿è¡Œæ—¶é…ç½®ã€ç›‘æ§å’Œåº”æ€¥å“åº”ç­‰å…³é”®ç¯èŠ‚
keywords:
  - Dockerå®‰å…¨
  - å®¹å™¨å®‰å…¨
  - é•œåƒå®‰å…¨
  - è¿è¡Œæ—¶å®‰å…¨
  - å®‰å…¨æ‰«æ
  - DevSecOps
tags:
  - å®¹å™¨å®‰å…¨
  - Docker
  - å®‰å…¨é˜²æŠ¤
  - è¿ç»´å®‰å…¨
  - ç³»ç»Ÿå®‰å…¨
---

# Dockerå®¹å™¨å®‰å…¨æœ€ä½³å®è·µæŒ‡å—

éšç€å®¹å™¨åŒ–æŠ€æœ¯åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­çš„å¹¿æ³›é‡‡ç”¨ï¼ŒDockerå®‰å…¨å·²æˆä¸ºç°ä»£ITåŸºç¡€è®¾æ–½çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚æœ¬æŒ‡å—å°†ä»å®æˆ˜è§’åº¦å‡ºå‘ï¼Œä¸ºå¼€å‘å›¢é˜Ÿå’Œè¿ç»´äººå‘˜æä¾›ç³»ç»Ÿæ€§çš„Dockerå®‰å…¨é˜²æŠ¤ç­–ç•¥ï¼Œç¡®ä¿å®¹å™¨åŒ–åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å®‰å…¨ç¨³å®šè¿è¡Œã€‚

## 1. é•œåƒå®‰å…¨ç­–ç•¥

### 1.1 åŸºç¡€é•œåƒé€‰æ‹©ä¸ç®¡ç†

**é€‰æ‹©å®˜æ–¹è®¤è¯é•œåƒ**
- ä¼˜å…ˆä½¿ç”¨Dockerå®˜æ–¹ä»“åº“ä¸­çš„`Official Images`æ ‡ç­¾é•œåƒ
- é€‰æ‹©æ´»è·ƒç»´æŠ¤çš„é•œåƒï¼ˆæœ€è¿‘30å¤©å†…æœ‰æ›´æ–°ï¼‰
- é¿å…ä½¿ç”¨ä¸ªäººæˆ–æœªçŸ¥æ¥æºçš„é•œåƒ

**æ¨èçš„åŸºç¡€é•œåƒé€‰æ‹©é¡ºåºï¼š**
```dockerfile
# æ¨èåº¦ï¼šé«˜ â†’ ä½
FROM alpine:3.18.4        # æœ€å°åŒ–Linuxå‘è¡Œç‰ˆï¼Œå®‰å…¨æ€§é«˜
FROM ubuntu:22.04         # å®˜æ–¹Ubuntuï¼Œå…¼å®¹æ€§å¥½
FROM debian:bookworm-slim # Debianç²¾ç®€ç‰ˆ
FROM scratch              # ç©ºé•œåƒï¼Œä»…é€‚ç”¨äºé™æ€ç¼–è¯‘çš„åº”ç”¨
```

**å»ºç«‹ç§æœ‰é•œåƒä»“åº“**
```bash
# éƒ¨ç½²Harborç§æœ‰ä»“åº“ç¤ºä¾‹
docker run -d -p 8080:80 -p 8443:443 \
  --name harbor \
  -v /opt/harbor/data:/data \
  goharbor/harbor-core:latest
```

### 1.2 é•œåƒæ„å»ºå®‰å…¨å®è·µ

**å¤šé˜¶æ®µæ„å»ºæœ€ä½³å®è·µ**
```dockerfile
# æ„å»ºé˜¶æ®µï¼šåŒ…å«å®Œæ•´å¼€å‘ç¯å¢ƒ
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force
COPY . .
RUN npm run build && \
    # æ¸…ç†æ„å»ºç¼“å­˜
    rm -rf node_modules && \
    rm -rf .npm

# ç”Ÿäº§é˜¶æ®µï¼šæœ€å°åŒ–è¿è¡Œç¯å¢ƒ
FROM nginx:1.24-alpine AS production
# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 appgroup && \
    adduser -D -u 1001 -G appgroup appuser

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder --chown=appuser:appgroup /app/dist /usr/share/nginx/html
COPY --chown=appuser:appgroup nginx.conf /etc/nginx/nginx.conf

# è®¾ç½®å®‰å…¨æƒé™
RUN chmod -R 755 /usr/share/nginx/html && \
    chown -R appuser:appgroup /var/cache/nginx

USER appuser
EXPOSE 8080
CMD ["nginx", "-g", "daemon off;"]
```

**å®‰å…¨çš„ä¾èµ–ç®¡ç†**
```dockerfile
# é”å®šç¡®åˆ‡ç‰ˆæœ¬ï¼Œé¿å…ä¾›åº”é“¾æ”»å‡»
FROM python:3.11.6-slim

# ä½¿ç”¨requirements.txté”å®šä¾èµ–ç‰ˆæœ¬
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt==1.2.3 \
    && pip check  # æ£€æŸ¥ä¾èµ–å†²çª
    
# éªŒè¯å…³é”®ä¾èµ–çš„å®Œæ•´æ€§
RUN pip show django | grep Version: | grep -q "4.2.7" || exit 1
```

### 1.3 é•œåƒå±‚ä¼˜åŒ–ä¸å®‰å…¨åŠ å›º

**å‡å°‘é•œåƒå±‚å’Œæ”»å‡»é¢**
```dockerfile
FROM alpine:3.18.4

# åˆå¹¶RUNæŒ‡ä»¤ï¼Œå‡å°‘é•œåƒå±‚
RUN apk add --no-cache \
    curl=8.4.0-r0 \
    jq=1.6-r4 \
    && rm -rf /var/cache/apk/* \
    && rm -rf /tmp/* \
    # ç§»é™¤ä¸å¿…è¦çš„åŒ…ç®¡ç†å™¨ç¼“å­˜
    && find /usr -name "*.pyc" -delete \
    && find /usr -name "__pycache__" -type d -exec rm -rf {} +

# ä½¿ç”¨.dockerignoreå‡å°‘æ„å»ºä¸Šä¸‹æ–‡
# .dockerignoreå†…å®¹ç¤ºä¾‹ï¼š
# node_modules
# .git
# *.log
# .env
# Dockerfile*
```

## 2. è¿è¡Œæ—¶å®‰å…¨é…ç½®

### 2.1 ç”¨æˆ·æƒé™å’Œè®¿é—®æ§åˆ¶

**å®æ–½æœ€å°æƒé™åŸåˆ™**
```bash
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„
docker run -d \
  --name secure-app \
  --user 1001:1001 \
  --cap-drop ALL \
  --cap-add NET_BIND_SERVICE \
  --no-new-privileges \
  --read-only \
  --tmpfs /tmp:rw,noexec,nosuid,size=100m \
  my-secure-app:latest
```

**æƒé™é…ç½®è¯¦è§£ï¼š**
- `--user 1001:1001`: æŒ‡å®šérootç”¨æˆ·è¿è¡Œ
- `--cap-drop ALL`: ç§»é™¤æ‰€æœ‰Linux capabilities
- `--cap-add NET_BIND_SERVICE`: ä»…æ·»åŠ ç»‘å®šç‰¹æƒç«¯å£çš„èƒ½åŠ›
- `--no-new-privileges`: é˜²æ­¢è¿›ç¨‹è·å–æ–°æƒé™
- `--read-only`: å°†æ ¹æ–‡ä»¶ç³»ç»Ÿè®¾ä¸ºåªè¯»
- `--tmpfs`: ä¸ºä¸´æ—¶æ–‡ä»¶åˆ›å»ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿ

### 2.2 ç½‘ç»œå®‰å…¨éš”ç¦»

**è‡ªå®šä¹‰ç½‘ç»œé…ç½®**
```bash
# åˆ›å»ºéš”ç¦»çš„è‡ªå®šä¹‰ç½‘ç»œ
docker network create \
  --driver bridge \
  --subnet=172.20.0.0/16 \
  --ip-range=172.20.240.0/20 \
  --gateway=172.20.0.1 \
  secure-network

# åœ¨éš”ç¦»ç½‘ç»œä¸­è¿è¡Œå®¹å™¨
docker run -d \
  --name web-app \
  --network secure-network \
  --ip 172.20.240.10 \
  -p 127.0.0.1:8080:80 \  # åªç»‘å®šåˆ°æœ¬åœ°æ¥å£
  nginx:alpine
```

**ç½‘ç»œç­–ç•¥é…ç½®**
```yaml
# docker-compose.ymlç½‘ç»œå®‰å…¨é…ç½®
version: '3.8'
services:
  web:
    image: nginx:alpine
    networks:
      - frontend
    ports:
      - "127.0.0.1:80:80"  # åªç»‘å®šæœ¬åœ°æ¥å£
    
  api:
    image: my-api:latest
    networks:
      - frontend
      - backend
    # ä¸æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœº
    
  database:
    image: postgres:15-alpine
    networks:
      - backend  # ä»…åœ¨åç«¯ç½‘ç»œï¼Œæ— æ³•ä»å¤–éƒ¨è®¿é—®
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    secrets:
      - db_password

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true  # å†…éƒ¨ç½‘ç»œï¼Œæ— å¤–ç½‘è®¿é—®

secrets:
  db_password:
    external: true
```

### 2.3 èµ„æºé™åˆ¶å’Œç›‘æ§

**ç»¼åˆèµ„æºé™åˆ¶é…ç½®**
```bash
docker run -d \
  --name resource-limited-app \
  --memory=512m \
  --memory-swap=512m \
  --memory-reservation=256m \
  --cpus="1.5" \
  --cpu-shares=1024 \
  --pids-limit=100 \
  --ulimit nofile=1024:1024 \
  --ulimit nproc=64:64 \
  --restart=unless-stopped \
  my-app:latest
```

**èµ„æºç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# container-monitor.sh - å®¹å™¨èµ„æºç›‘æ§è„šæœ¬

CONTAINER_NAME="my-app"
ALERT_MEMORY_THRESHOLD=80  # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦é˜ˆå€¼
ALERT_CPU_THRESHOLD=90     # CPUä½¿ç”¨ç‡å‘Šè­¦é˜ˆå€¼

while true; do
    # è·å–å®¹å™¨ç»Ÿè®¡ä¿¡æ¯
    STATS=$(docker stats --no-stream --format "{{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}" $CONTAINER_NAME)
    
    if [ -n "$STATS" ]; then
        CPU_PERCENT=$(echo $STATS | awk '{print $2}' | sed 's/%//')
        MEM_PERCENT=$(echo $STATS | awk '{print $4}' | sed 's/%//')
        
        # æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡
        if (( $(echo "$MEM_PERCENT > $ALERT_MEMORY_THRESHOLD" | bc -l) )); then
            echo "$(date): ALERT - Memory usage: ${MEM_PERCENT}%" >> /var/log/container-alerts.log
        fi
        
        # æ£€æŸ¥CPUä½¿ç”¨ç‡
        if (( $(echo "$CPU_PERCENT > $ALERT_CPU_THRESHOLD" | bc -l) )); then
            echo "$(date): ALERT - CPU usage: ${CPU_PERCENT}%" >> /var/log/container-alerts.log
        fi
    fi
    
    sleep 30
done
```

## 3. å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯ç®¡ç†

### 3.1 Docker Secretså®è·µ

**ç”Ÿäº§ç¯å¢ƒå¯†é’¥ç®¡ç†**
```bash
# åˆ›å»ºæ•°æ®åº“å¯†ç å¯†é’¥
echo "super_secret_password" | docker secret create db_password -

# åˆ›å»ºTLSè¯ä¹¦å¯†é’¥
docker secret create ssl_cert /path/to/certificate.pem
docker secret create ssl_key /path/to/private.key

# åœ¨æœåŠ¡ä¸­ä½¿ç”¨å¯†é’¥
docker service create \
  --name secure-web \
  --secret db_password \
  --secret ssl_cert \
  --secret ssl_key \
  --mount type=tmpfs,destination=/run/secrets \
  my-secure-web:latest
```

**åº”ç”¨ç¨‹åºä¸­è¯»å–å¯†é’¥ç¤ºä¾‹**
```python
# Pythonåº”ç”¨è¯»å–Dockerå¯†é’¥
import os

def read_secret(secret_name):
    """å®‰å…¨è¯»å–Dockerå¯†é’¥"""
    secret_path = f'/run/secrets/{secret_name}'
    try:
        with open(secret_path, 'r') as f:
            return f.read().strip()
    except FileNotFoundError:
        # é™çº§åˆ°ç¯å¢ƒå˜é‡ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
        return os.environ.get(secret_name.upper())
    except Exception as e:
        print(f"Error reading secret {secret_name}: {e}")
        return None

# ä½¿ç”¨ç¤ºä¾‹
db_password = read_secret('db_password')
if db_password:
    # è¿æ¥æ•°æ®åº“
    pass
```

### 3.2 ç¯å¢ƒå˜é‡å®‰å…¨å®è·µ

**å®‰å…¨çš„ç¯å¢ƒå˜é‡å¤„ç†**
```bash
# ä½¿ç”¨envæ–‡ä»¶ç®¡ç†éæ•æ„Ÿé…ç½®
cat > app.env << EOF
APP_ENV=production
LOG_LEVEL=info
DEBUG=false
API_VERSION=v1
EOF

# æ•æ„Ÿä¿¡æ¯é€šè¿‡å¯†é’¥æˆ–è¿è¡Œæ—¶æ³¨å…¥
docker run -d \
  --name secure-app \
  --env-file app.env \
  --env DB_HOST=postgres.internal \
  --mount type=bind,source=/etc/ssl/certs,target=/etc/ssl/certs,readonly \
  my-app:latest
```

## 4. å®‰å…¨æ‰«æå’Œæ¼æ´ç®¡ç†

### 4.1 é›†æˆåŒ–å®‰å…¨æ‰«ææµç¨‹

**CI/CDç®¡é“ä¸­çš„å®‰å…¨æ‰«æ**
```yaml
# .github/workflows/security-scan.yml
name: Container Security Scan
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker image
        run: docker build -t ${{ github.repository }}:${{ github.sha }} .
        
      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: '${{ github.repository }}:${{ github.sha }}'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH,MEDIUM'
          exit-code: '1'  # å‘ç°é«˜å±æ¼æ´æ—¶å¤±è´¥
          
      - name: Upload Trivy scan results
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'trivy-results.sarif'
          
      - name: Security audit with Snyk
        run: |
          npm install -g snyk
          snyk test --docker ${{ github.repository }}:${{ github.sha }} --severity-threshold=high
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

**æœ¬åœ°å®‰å…¨æ‰«æè„šæœ¬**
```bash
#!/bin/bash
# security-scan.sh - æœ¬åœ°é•œåƒå®‰å…¨æ‰«æè„šæœ¬

IMAGE_NAME=$1
SCAN_REPORT_DIR="./security-reports"

if [ -z "$IMAGE_NAME" ]; then
    echo "Usage: $0 <image-name>"
    exit 1
fi

mkdir -p $SCAN_REPORT_DIR

echo "ğŸ” å¼€å§‹å®‰å…¨æ‰«æ: $IMAGE_NAME"

# Trivyæ¼æ´æ‰«æ
echo "ğŸ“‹ è¿è¡ŒTrivyæ¼æ´æ‰«æ..."
trivy image \
    --format json \
    --output "$SCAN_REPORT_DIR/trivy-$(date +%Y%m%d-%H%M%S).json" \
    --severity HIGH,CRITICAL \
    $IMAGE_NAME

# é•œåƒé…ç½®æ‰«æ
echo "âš™ï¸ æ£€æŸ¥é•œåƒé…ç½®..."
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
    goodwithtech/dockle:latest $IMAGE_NAME \
    > "$SCAN_REPORT_DIR/dockle-$(date +%Y%m%d-%H%M%S).txt"

# ç”Ÿæˆå®‰å…¨æŠ¥å‘Šæ‘˜è¦
echo "ğŸ“Š ç”Ÿæˆå®‰å…¨æŠ¥å‘Šæ‘˜è¦..."
cat > "$SCAN_REPORT_DIR/security-summary.txt" << EOF
é•œåƒå®‰å…¨æ‰«ææŠ¥å‘Š
================
é•œåƒåç§°: $IMAGE_NAME
æ‰«ææ—¶é—´: $(date)
æ‰«æå·¥å…·: Trivy, Dockle

è¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹åŒç›®å½•ä¸‹çš„å…·ä½“æ‰«æç»“æœæ–‡ä»¶ã€‚

å»ºè®®çš„å®‰å…¨æ”¹è¿›æªæ–½:
1. å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
2. ç§»é™¤ä¸å¿…è¦çš„åŒ…å’Œæ–‡ä»¶
3. ä½¿ç”¨érootç”¨æˆ·è¿è¡Œåº”ç”¨
4. å¯ç”¨åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
5. é™åˆ¶å®¹å™¨æƒé™å’Œèµ„æºä½¿ç”¨
EOF

echo "âœ… å®‰å…¨æ‰«æå®Œæˆï¼ŒæŠ¥å‘Šä¿å­˜åœ¨: $SCAN_REPORT_DIR"
```

### 4.2 è¿è¡Œæ—¶å®‰å…¨ç›‘æ§

**Falcoè§„åˆ™é…ç½®**
```yaml
# falco-rules.yaml - è‡ªå®šä¹‰å®‰å…¨ç›‘æ§è§„åˆ™
- rule: Detect shell in container
  desc: å‘ç°å®¹å™¨ä¸­æ‰§è¡Œshellå‘½ä»¤
  condition: >
    spawned_process and container and
    (proc.name in (bash, sh, zsh, fish, csh, ksh))
  output: >
    Shell spawned in container
    (user=%user.name container=%container.name shell=%proc.name parent=%proc.pname cmdline=%proc.cmdline)
  priority: WARNING
  tags: [container, shell, mitre_execution]

- rule: Unexpected file access in container
  desc: æ£€æµ‹å®¹å™¨ä¸­å¼‚å¸¸æ–‡ä»¶è®¿é—®
  condition: >
    open_write and container and
    (fd.name startswith /etc/ or
     fd.name startswith /root/ or
     fd.name startswith /var/log/)
  output: >
    Unexpected file write in container
    (user=%user.name container=%container.name file=%fd.name)
  priority: WARNING
  tags: [container, filesystem]
```

## 5. åº”æ€¥å“åº”å’Œäº‹ä»¶å¤„ç†

### 5.1 å®‰å…¨äº‹ä»¶å“åº”æµç¨‹

**å®¹å™¨å®‰å…¨äº‹ä»¶å¤„ç†è„šæœ¬**
```bash
#!/bin/bash
# incident-response.sh - å®¹å™¨å®‰å…¨äº‹ä»¶å“åº”è„šæœ¬

CONTAINER_ID=$1
INCIDENT_TYPE=$2
LOG_DIR="/var/log/security-incidents"

if [ -z "$CONTAINER_ID" ] || [ -z "$INCIDENT_TYPE" ]; then
    echo "Usage: $0 <container-id> <incident-type>"
    exit 1
fi

TIMESTAMP=$(date +%Y%m%d-%H%M%S)
INCIDENT_DIR="$LOG_DIR/incident-$TIMESTAMP-$CONTAINER_ID"

echo "ğŸš¨ æ£€æµ‹åˆ°å®‰å…¨äº‹ä»¶: $INCIDENT_TYPE"
echo "ğŸ“ åˆ›å»ºäº‹ä»¶è®°å½•ç›®å½•: $INCIDENT_DIR"
mkdir -p "$INCIDENT_DIR"

# 1. å¿«ç…§å®¹å™¨çŠ¶æ€
echo "ğŸ“¸ ä¿å­˜å®¹å™¨çŠ¶æ€å¿«ç…§..."
docker inspect $CONTAINER_ID > "$INCIDENT_DIR/container-inspect.json"
docker logs $CONTAINER_ID > "$INCIDENT_DIR/container-logs.txt" 2>&1
docker stats --no-stream $CONTAINER_ID > "$INCIDENT_DIR/container-stats.txt"

# 2. ç½‘ç»œè¿æ¥ä¿¡æ¯
echo "ğŸŒ æ”¶é›†ç½‘ç»œè¿æ¥ä¿¡æ¯..."
docker exec $CONTAINER_ID netstat -tulpn > "$INCIDENT_DIR/network-connections.txt" 2>/dev/null || echo "æ— æ³•è·å–ç½‘ç»œä¿¡æ¯" > "$INCIDENT_DIR/network-connections.txt"

# 3. è¿›ç¨‹ä¿¡æ¯
echo "âš™ï¸ æ”¶é›†è¿›ç¨‹ä¿¡æ¯..."
docker exec $CONTAINER_ID ps aux > "$INCIDENT_DIR/process-list.txt" 2>/dev/null || echo "æ— æ³•è·å–è¿›ç¨‹ä¿¡æ¯" > "$INCIDENT_DIR/process-list.txt"

# 4. æ–‡ä»¶ç³»ç»Ÿå˜æ›´
echo "ğŸ“ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿå˜æ›´..."
docker diff $CONTAINER_ID > "$INCIDENT_DIR/filesystem-changes.txt"

# 5. æ ¹æ®äº‹ä»¶ç±»å‹é‡‡å–ç›¸åº”æªæ–½
case $INCIDENT_TYPE in
    "malware")
        echo "ğŸ›¡ï¸ æ£€æµ‹åˆ°æ¶æ„è½¯ä»¶ï¼Œç«‹å³éš”ç¦»å®¹å™¨..."
        docker pause $CONTAINER_ID
        docker network disconnect bridge $CONTAINER_ID 2>/dev/null
        ;;
    "privilege_escalation")
        echo "âš ï¸ æ£€æµ‹åˆ°æƒé™æå‡ï¼Œåœæ­¢å®¹å™¨..."
        docker stop $CONTAINER_ID
        ;;
    "data_exfiltration")
        echo "ğŸ”’ æ£€æµ‹åˆ°æ•°æ®å¤–æ³„ï¼Œæ–­å¼€ç½‘ç»œè¿æ¥..."
        docker network disconnect bridge $CONTAINER_ID 2>/dev/null
        ;;
    *)
        echo "â“ æœªçŸ¥äº‹ä»¶ç±»å‹ï¼Œæ‰§è¡Œé€šç”¨éš”ç¦»æªæ–½..."
        docker pause $CONTAINER_ID
        ;;
esac

# 6. ç”Ÿæˆäº‹ä»¶æŠ¥å‘Š
cat > "$INCIDENT_DIR/incident-report.txt" << EOF
å®¹å™¨å®‰å…¨äº‹ä»¶æŠ¥å‘Š
===============
äº‹ä»¶ID: incident-$TIMESTAMP-$CONTAINER_ID
äº‹ä»¶ç±»å‹: $INCIDENT_TYPE
å‘ç”Ÿæ—¶é—´: $(date)
å—å½±å“å®¹å™¨: $CONTAINER_ID
å“åº”æªæ–½: å·²æ ¹æ®äº‹ä»¶ç±»å‹é‡‡å–ç›¸åº”éš”ç¦»æªæ–½

è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹åŒç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶ï¼š
- container-inspect.json: å®¹å™¨è¯¦ç»†é…ç½®
- container-logs.txt: å®¹å™¨æ—¥å¿—
- network-connections.txt: ç½‘ç»œè¿æ¥ä¿¡æ¯
- process-list.txt: è¿›ç¨‹åˆ—è¡¨
- filesystem-changes.txt: æ–‡ä»¶ç³»ç»Ÿå˜æ›´

å»ºè®®åç»­è¡ŒåŠ¨:
1. æ·±å…¥åˆ†æå®¹å™¨é•œåƒå’Œé…ç½®
2. æ£€æŸ¥å®¿ä¸»æœºæ˜¯å¦å—åˆ°å½±å“
3. æ›´æ–°å®‰å…¨ç­–ç•¥å’Œç›‘æ§è§„åˆ™
4. é€šçŸ¥ç›¸å…³å›¢é˜Ÿå’Œç®¡ç†å±‚
EOF

echo "âœ… äº‹ä»¶å“åº”å®Œæˆï¼Œè¯¦ç»†ä¿¡æ¯ä¿å­˜åœ¨: $INCIDENT_DIR"
echo "ğŸ“§ å»ºè®®é€šçŸ¥å®‰å…¨å›¢é˜Ÿè¿›è¡Œè¿›ä¸€æ­¥åˆ†æ"
```

### 5.2 å®¹å™¨å–è¯å’Œæ¢å¤

**å®¹å™¨å–è¯å·¥å…·**
```bash
#!/bin/bash
# container-forensics.sh - å®¹å™¨å–è¯åˆ†æå·¥å…·

CONTAINER_ID=$1
FORENSICS_DIR="/var/forensics/$(date +%Y%m%d-%H%M%S)-$CONTAINER_ID"

mkdir -p "$FORENSICS_DIR"

echo "ğŸ” å¼€å§‹å®¹å™¨å–è¯åˆ†æ: $CONTAINER_ID"

# åˆ›å»ºå®¹å™¨é•œåƒå¿«ç…§
echo "ğŸ“¸ åˆ›å»ºå®¹å™¨é•œåƒå¿«ç…§..."
docker commit $CONTAINER_ID forensics-snapshot:$CONTAINER_ID-$(date +%s)

# å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿ
echo "ğŸ’¾ å¯¼å‡ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿ..."
docker export $CONTAINER_ID | tar -xC "$FORENSICS_DIR/filesystem/"

# åˆ†æå®¹å™¨å…ƒæ•°æ®
echo "ğŸ“‹ åˆ†æå®¹å™¨å…ƒæ•°æ®..."
docker inspect $CONTAINER_ID | jq . > "$FORENSICS_DIR/metadata.json"

# æå–å…³é”®æ—¥å¿—å’Œé…ç½®æ–‡ä»¶
echo "ğŸ“„ æå–å…³é”®æ–‡ä»¶..."
CRITICAL_PATHS=("/etc/passwd" "/etc/shadow" "/var/log" "/root/.bash_history" "/home/*/.bash_history")
for path in "${CRITICAL_PATHS[@]}"; do
    if [ -f "$FORENSICS_DIR/filesystem$path" ]; then
        cp -r "$FORENSICS_DIR/filesystem$path" "$FORENSICS_DIR/critical-files/" 2>/dev/null
    fi
done

echo "âœ… å–è¯åˆ†æå®Œæˆï¼Œæ•°æ®ä¿å­˜åœ¨: $FORENSICS_DIR"
```
